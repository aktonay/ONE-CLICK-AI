{# Edge AI Service #}
"""
Edge AI service layer.
"""

import logging
from typing import Any, Dict
import numpy as np

logger = logging.getLogger(__name__)


class EdgeService:
    """High-level Edge AI service."""

    def __init__(self):
        self._runtimes = {}

    async def get_runtime(self, model_path: str, runtime: str = "onnx"):
        from app.edge.runtime import EdgeRuntime
        key = f"{model_path}:{runtime}"
        if key not in self._runtimes:
            self._runtimes[key] = EdgeRuntime(model_path, runtime=runtime)
        return self._runtimes[key]

    async def predict(self, model_path: str, input_data: np.ndarray, runtime: str = "onnx"):
        rt = await self.get_runtime(model_path, runtime)
        return rt.predict(input_data)

    async def benchmark(self, model_path: str, input_shape: list, runtime: str = "onnx", iterations: int = 100):
        rt = await self.get_runtime(model_path, runtime)
        dummy = np.random.randn(*input_shape).astype(np.float32)
        return rt.benchmark(dummy, iterations=iterations)
