{# Analytics Service #}
"""
Analytics service layer.
"""

import logging
from typing import Any, Dict, List

logger = logging.getLogger(__name__)


class AnalyticsService:
    """High-level analytics service."""

    def __init__(self, db_url: str = "sqlite:///data.db"):
        self.db_url = db_url

    async def ask(self, question: str) -> Dict[str, Any]:
        from app.analytics.text_to_sql import TextToSQLEngine
        engine = TextToSQLEngine(db_url=self.db_url)
        return engine.ask(question)

    async def generate_chart(self, data: Dict, chart_type: str = "auto", **kwargs) -> str:
        from app.analytics.chart_gen import ChartGenerator
        gen = ChartGenerator()
        if chart_type == "auto":
            return gen.auto_chart(data)
        method = getattr(gen, f"{chart_type}_chart", gen.auto_chart)
        return method(data, **kwargs)

    async def generate_report(self, questions: List[str], title: str = "Report") -> str:
        from app.analytics.text_to_sql import TextToSQLEngine
        from app.analytics.chart_gen import ChartGenerator
        from app.analytics.report import ReportGenerator
        sql = TextToSQLEngine(db_url=self.db_url)
        chart = ChartGenerator()
        report = ReportGenerator()
        return report.generate_from_questions(questions, sql, chart)
